<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        canvas {
            border: 10px solid #d61414;
            background-color: #f5f1f1;
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
        }
    </style>
</head>

<body onload="startGame()">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/js/all.min.js"
        integrity="sha512-rpLlll167T5LJHwp0waJCh3ZRf7pO6IT1+LZOhAyP6phAirwchClbTZV3iqL3BMrVxIYRbzGTpli4rfxsCK6Vw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>


    <div class="container mt-5">
        <div class="row align-middle">
            <div id="liveAlertPlaceholder"></div>
        </div>
    </div>

    <div id="myCanvas"></div>


</body>

<script src="/dist/js/game.js"></script>

<script>
    const appendAlert = (message, type) => {
        const wrapper = document.createElement('div')
        wrapper.innerHTML = [
            `<div class="alert alert-${type}">`,
            `   <div>${message}</div>`,
            '</div>'
        ].join('')
        $("#liveAlertPlaceholder").append(wrapper);
    }


    introMessage = [
        `<h1 class='mt-5'> Game of Death</h1>`,
        `<input type="user" class="form-control" id="gamername"`,
        `placeholder="Enter User Name and Press Play">`,
        `<button type="submit" class="btn btn-primary my-5" id="submitButton">Play</button>`,
    ].join('');

    appendAlert(introMessage, 'warning');
    $("#submitButton").click(checkUser);

    function checkUser() {
        val = $("#gamername").val();
        if (gamePlayer == null) {
            if (!val) {
                alert("Please Enter a User Name");
            } else {
                $.get("/game/sign/" + val, function() {
                    gamePlayer = val;
                    myGameArea.start();
                    $("#liveAlertPlaceholder").html("");
                });
            }
        } else {
            controls = true;
            startGame();
            myGameArea.start();
        }
    };




    document.addEventListener('keydown', (event) => {
        switch (event.key) {
            case 'ArrowUp':
                moveup();
                break;
            case 'ArrowRight':
                moveright();
                break;
            case 'ArrowLeft':
                moveleft();
                break;
        }
    });


    document.addEventListener('keyup', (event) => {
        switch (event.key) {
            case 'ArrowUp':
                clearThrust();
                break;
            case 'ArrowRight':
                moveright();
                break;
            case 'ArrowLeft':
                moveleft();
                break;
        }
    });


    function swipedetect(el, callback) {

        var touchsurface = el,
            swipedir,
            startX,
            startY,
            distX,
            distY,
            threshold = 150, //required min distance traveled to be considered swipe
            restraint = 100, // maximum distance allowed at the same time in perpendicular direction
            allowedTime = 300, // maximum time allowed to travel that distance
            elapsedTime,
            startTime,
            handleswipe = callback || function(swipedir) {}

        touchsurface.addEventListener('touchstart', function(e) {
            var touchobj = e.changedTouches[0]
            swipedir = 'none'
            dist = 0
            startX = touchobj.pageX
            startY = touchobj.pageY
            startTime = new Date().getTime() // record time when finger first makes contact with surface
            e.preventDefault()
        }, false)

        touchsurface.addEventListener('touchmove', function(e) {
            e.preventDefault() // prevent scrolling when inside DIV
        }, false)

        touchsurface.addEventListener('touchend', function(e) {
            var touchobj = e.changedTouches[0]
            distX = touchobj.pageX -
                startX // get horizontal dist traveled by finger while in contact with surface
            distY = touchobj.pageY -
                startY // get vertical dist traveled by finger while in contact with surface
            elapsedTime = new Date().getTime() - startTime // get time elapsed
            if (elapsedTime <= allowedTime) { // first condition for awipe met
                if (Math.abs(distX) >= threshold && Math.abs(distY) <=
                    restraint) { // 2nd condition for horizontal swipe met
                    swipedir = (distX < 0) ? 'left' :
                        'right' // if dist traveled is negative, it indicates left swipe
                } else if (Math.abs(distY) >= threshold && Math.abs(distX) <=
                    restraint) { // 2nd condition for vertical swipe met
                    swipedir = (distY < 0) ? 'up' :
                        'down' // if dist traveled is negative, it indicates up swipe
                }
            }
            handleswipe(swipedir)
            e.preventDefault()
        }, false)
    }

    var el = document.getElementById('touchscreen');
    swipedetect(el, function(swipedir) {
        console.log("here")
        switch (swipedir) {

            case 'right':
                moveright();

                break;
            case 'left':
                moveleft();

                break;
        }
    })


    el.addEventListener('touchstart', function(e) {
        moveup();
        e.preventDefault()
    }, false)


    el.addEventListener('touchend', function(e) {
        clearThrust()
        e.preventDefault()
    }, false)
</script>





</html>